import{_ as v,o as s,c as l,b as t,t as n,f as y,F as p,i as O,k as M,R as $,S as k,r as m,h as V,e as E,T as D,d as f,n as T}from"./index-45ab631b.js";import{D as S,P as A}from"./DelModal-767c96d4.js";import{T as _}from"./toast-6c96786e.js";const B={props:["order"],data(){return{tempOrder:{}}},watch:{order(){this.tempOrder=this.order}}},I={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},R=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={class:"modal-body"},z={class:"row"},F={class:"col-md-4"},H=t("h3",null,"用戶資料",-1),j={class:"table"},G={key:0},J=t("th",{style:{width:"100px"}},"姓名",-1),K=t("th",null,"Email",-1),Q=t("th",null,"電話",-1),W=t("th",null,"地址",-1),X={class:"col-md-8"},Y=t("h3",null,"訂單細節",-1),Z={class:"table"},tt=t("th",{style:{width:"100px"}},"訂單編號",-1),et=t("th",null,"下單時間",-1),st=t("th",null,"付款時間",-1),lt={key:0},ot={key:1},nt=t("th",null,"付款狀態",-1),it={key:0,class:"text-success"},dt={key:1,class:"text-muted"},at=t("th",null,"總金額",-1),rt=t("h3",null,"選購商品",-1),ct={class:"table"},ut=t("thead",null,[t("tr")],-1),ht={class:"text-end"},_t={class:"d-flex justify-content-end"},pt={class:"form-check"},mt={class:"form-check-label",for:"flexCheckDefault"},ft={key:0},bt={key:1},gt={class:"modal-footer"},yt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ot(o,i,r,h,e,u){return s(),l("div",I,[t("div",N,[t("div",U,[R,t("div",q,[t("div",z,[t("div",F,[H,t("table",j,[e.tempOrder.user?(s(),l("tbody",G,[t("tr",null,[J,t("td",null,n(e.tempOrder.user.name),1)]),t("tr",null,[K,t("td",null,n(e.tempOrder.user.email),1)]),t("tr",null,[Q,t("td",null,n(e.tempOrder.user.tel),1)]),t("tr",null,[W,t("td",null,n(e.tempOrder.user.address),1)])])):y("",!0)])]),t("div",X,[Y,t("table",Z,[t("tbody",null,[t("tr",null,[tt,t("td",null,n(e.tempOrder.id),1)]),t("tr",null,[et,t("td",null,n(o.$filters.date(e.tempOrder.create_at)),1)]),t("tr",null,[st,t("td",null,[e.tempOrder.paid_date?(s(),l("span",lt,n(o.$filters.date(e.tempOrder.paid_date)),1)):(s(),l("span",ot,"時間不正確"))])]),t("tr",null,[nt,t("td",null,[e.tempOrder.is_paid?(s(),l("strong",it,"已付款")):(s(),l("span",dt,"尚未付款"))])]),t("tr",null,[at,t("td",null,n(o.$filters.currency(e.tempOrder.total)),1)])])]),rt,t("table",ct,[ut,t("tbody",null,[(s(!0),l(p,null,O(e.tempOrder.products,a=>(s(),l("tr",{key:a.id},[t("th",null,n(a.product.title),1),t("td",null,n(a.qty)+" / "+n(a.product.unit),1),t("td",ht,n(o.$filters.currency(a.final_total)),1)]))),128))])]),t("div",_t,[t("div",pt,[M(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":i[0]||(i[0]=a=>e.tempOrder.is_paid=a)},null,512),[[$,e.tempOrder.is_paid]]),t("label",mt,[e.tempOrder.is_paid?(s(),l("span",ft,"已付款")):(s(),l("span",bt,"未付款"))])])])])])]),t("div",gt,[yt,t("button",{type:"button",class:"btn btn-primary",onClick:i[1]||(i[1]=a=>o.$emit("update-paid",e.tempOrder))}," 修改付款狀態 ")])])])],512)}const kt=v(B,[["render",Ot]]),{VITE_API:b,VITE_PATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"howtobefine",BASE_URL:"/plat-records/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},vt={data(){return{orders:{},isNew:!1,isPaid:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1,orderModal:"",delModal:""}},methods:{getOrders(o=1){this.currentPage=o;const i=`${b}api/${g}/admin/orders/?page=${o}`;this.isLoading=!0,this.$http.get(i).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.isLoading=!1}).catch(r=>{this.isLoading=!1,_.fire({icon:"error",title:`${r.response.data.message}`})})},openModal(o,i){o==="edit"?(this.orderModal.show(),this.tempOrder={...i},this.isNew=!1):o==="del"&&(this.delModal.show(),this.tempOrder={...i})},updatePaid(o){const i=`${b}api/${g}/admin/order/${o.id}`;this.isLoading=!0;const r={is_paid:o.is_paid};this.$http.put(i,{data:r}).then(h=>{this.isLoading=!1,this.orderModal.hide(),_.fire({icon:"success",title:`${h.data.message}`}),this.getOrders(this.currentPage)}).catch(h=>{this.isLoading=!1,_.fire({icon:"error",title:`${h.response.data.message}`})})},delOrder(){const o=`${b}api/${g}/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(o).then(i=>{this.isLoading=!1,this.delModal.hide(),_.fire({icon:"success",title:`${i.data.message}`}),this.getOrders()}).catch(i=>{this.isLoading=!1,_.fire({icon:"error",title:`${i.response.data.message}`})})}},components:{DelModal:S,PaginationView:A,OrderModal:kt},mounted(){this.getOrders(),this.orderModal=new k("#orderModal"),this.delModal=new k("#delModal")}},Mt={class:"table mt-4"},$t=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),xt=["textContent"],Pt={class:"list-unstyled"},wt={class:"text-right"},Ct={class:"form-check form-switch"},Lt=["id","onUpdate:modelValue","onChange"],Vt=["for"],Et={key:0},Dt={key:1},Tt={class:"btn-group"},St=["onClick"],At=["onClick"];function Bt(o,i,r,h,e,u){const a=m("VueLoading"),x=m("PaginationView"),P=m("OrderModal"),w=m("DelModal");return s(),l(p,null,[(s(),V(D,{to:"title"},[E("｜後臺管理")])),t("div",null,[f(a,{active:e.isLoading,"z-index":1060,loader:"dots",color:"#CB4042",transition:"fade"},null,8,["active"]),t("table",Mt,[$t,t("tbody",null,[(s(!0),l(p,null,O(e.orders,(d,C)=>(s(),l(p,{key:C},[e.orders.length?(s(),l("tr",{key:0,class:T({"text-muted":!d.is_paid})},[t("td",null,n(o.$filters.date(d.create_at)),1),t("td",null,[d.user?(s(),l("span",{key:0,textContent:n(d.user.email)},null,8,xt)):y("",!0)]),t("td",null,[t("ul",Pt,[(s(!0),l(p,null,O(d.products,(c,L)=>(s(),l("li",{key:L},n(c.product.title)+" 數量："+n(c.qty)+" "+n(c.product.unit),1))),128))])]),t("td",wt,n(d.total),1),t("td",null,[t("div",Ct,[M(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":c=>d.is_paid=c,onChange:c=>u.updatePaid(d)},null,40,Lt),[[$,d.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${d.id}`},[d.is_paid?(s(),l("span",Et,"已付款")):(s(),l("span",Dt,"未付款"))],8,Vt)])]),t("td",null,[t("div",Tt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>u.openModal("edit",d)}," 檢視 ",8,St),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>u.openModal("del",d)}," 刪除 ",8,At)])])],2)):y("",!0)],64))),128))])])]),f(x,{pagination:e.pagination,onEmitPages:u.getOrders},null,8,["pagination","onEmitPages"]),f(P,{order:e.tempOrder,onUpdatePaid:u.updatePaid},null,8,["order","onUpdatePaid"]),f(w,{item:e.tempOrder,onDelEmit:u.delOrder},null,8,["item","onDelEmit"])],64)}const Rt=v(vt,[["render",Bt]]);export{Rt as default};
